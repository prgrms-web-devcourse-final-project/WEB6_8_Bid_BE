<!doctype html>
<meta charset="utf-8">
<title>Toss Billing Auth</title>
<script src="https://js.tosspayments.com/v1"></script>

<button id="pay">결제하기</button>

<script>
    document.getElementById('pay').onclick = async () => {
      // ★ 로그인 후 쿠키로 인증되므로 credentials: 'include'
      const r = await fetch('/api/v1/payments/toss/billing-auth-params', { credentials: 'include' });
      if (!r.ok) { alert('인증 필요'); return; }
      const body = await r.json();
      const p = body.data || body;

      const toss = TossPayments(p.clientKey);
      toss.requestBillingAuth('카드', {
        customerKey: p.customerKey,   // 서버가 계산해 준 값
        successUrl:  p.successUrl,    // 예: http://localhost:8080/payments/toss/billing-success.html
        failUrl:     p.failUrl
      });
    };
</script>
